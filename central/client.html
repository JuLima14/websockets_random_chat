<!DOCTYPE HTML>
<html>
    <head>
        <title>Central Chat</title>
        <script src="http://code.jquery.com/jquery-1.9.1.min.js">
        </script>
    </head>
    <body>
		Your name:
		<input type="text" id="name" size="100"/><br/>
        <input type="button" id="create" value="Enviar" onclick="register()"/>

		<br><br>
		
		<br><br>

        Message:
        <input type="text" id="message" size="100"/><br/>
        <input type="button" id="send" value="Enviar" onclick="sendMessage()"/>
        <div id="output"></div>
    </body>

    <script>
		var socket;
		
		var registry = {type: 'registry', value: ''};
		var getUsersMessage = {type: 'users', value: ''};
		var message = {type: 'message', value: '', to: ''};
		
		var users = [];
	
		function register() {
			socket = new WebSocket('ws://127.0.0.1:9000/');

			socket.onopen = function(event) {
                registry.value = $('#name').val();
				socket.send(JSON.stringify(registry));
				socket.send(JSON.stringify(getUsersMessage));
            }
            
            socket.onmessage = function(event) {
				var reply = JSON.parse(event.data);
				
				if (reply.type == 'users') {
					users = reply.value;
					console.log('users are: ', users);
				}
				
				if (reply.type == 'message') {
					$('#output').append(reply.value + '<br>');
				}
            }

            $(window).unload(function(event) {
                socket.close();
            });
		}

		function sendMessage() {
			message.value = $('#message').val();
			socket.send(JSON.stringify(message));
		}
    </script>

</html>